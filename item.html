<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>藥物資訊</title>

<style>
body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
  margin: 0;
  padding: 16px;
  background: #f5f5f5;
}
.card {
  background: white;
  border-radius: 12px;
  padding: 16px;
  margin-bottom: 16px;
}
h2 { margin-top: 0; }
.video {
  margin-top: 12px;
}
button {
  padding: 10px 14px;
  border-radius: 8px;
  border: none;
  background: #007aff;
  color: white;
  font-size: 16px;
}
</style>
</head>

<body>

<div id="content"></div>

<script>
const API_BASE = '<<<貼你的 GAS URL 在這>>>';

const code = new URLSearchParams(location.search).get('code');

fetch(`${API_BASE}?action=item&code5=${code}`)
  .then(r => r.json())
  .then(d => { saveRecent_(d); render(d); });

function render(d) {
  const el = document.getElementById('content');
  el.innerHTML = `
    <div class="card">
      <h2>${d.brand_name}</h2>
      <div>${d.generic_name}</div>
      <div>代碼：${d.code5}</div>
    </div>

    <div class="card">
      <h3>衛教說明</h3>
      <div>${(d.counsel_text || '').replace(/\n/g,'<br>')}</div>
    </div>

    <div class="card">
      <h3>適應症與劑量</h3>
      <div>${(d.indication_dose || '').replace(/\n/g,'<br>')}</div>
    </div>
  `;

  if (d.video_url) {
    d.video_url.split(',').forEach(url => {
      const vid = url.trim().split('v=')[1];
      const box = document.createElement('div');
      box.className = 'card video';
      box.innerHTML = `
        <button onclick="this.outerHTML='<iframe width=100% height=215 src=https://www.youtube.com/embed/${vid} allowfullscreen></iframe>'">
          ▶ 播放衛教影片
        </button>`;
      el.appendChild(box);
    });
  }
}
  function saveRecent_(d) {
  try {
    const key = 'pharma_recent_v1';
    const list = JSON.parse(localStorage.getItem(key) || '[]');

    const item = {
      code5: String(d.code5 || ''),
      item_name: d.item_name || '',
      brand_name: d.brand_name || '',
      category: d.category || ''
    };

    // 移除同 code5 舊項目（避免重複）
    const next = [item, ...list.filter(x => String(x.code5) !== item.code5)]
      .slice(0, 5); // 最多留 5 筆

    localStorage.setItem(key, JSON.stringify(next));
  } catch (err) {
    // localStorage 失敗就忽略（不影響頁面）
  }
}
</script>

</body>
</html>
